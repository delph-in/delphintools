#!/bin/bash

fan2stats_tab () {
    grep '|=' |
    sed 's/:0//g
	 s/+0.0//g
	 s/[{}<>;]//g' |
    awk '
    BEGIN {
                OFS = "\t"
    }
    /\|=/ {
		parse += $2
		transfer += $6
		generate += $11
		total += $19
		b = NF - 1 
		split($b, scores, "|")
		bleu += scores[1] * $17 
		oracle += $NF * $17
    }
    END {
                year = substr("'$1'", 1, 4)
                month = substr("'$1'", 5, 2)
                day = substr("'$1'", 7, 2)
                date = sprintf("%s-%s-%s", year, month, day)
                note = "+CHANGE"
		bleu /= generate
		oracle /= generate
		precision = bleu
		recall = generate / total
		f = (2 * precision * recall) / (precision + recall)
                print date, bleu, oracle, f, parse, transfer, generate, total, note
   }'
}

fan2stats_tab $* 
