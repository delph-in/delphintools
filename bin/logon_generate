#!/bin/bash

# generate from a profile and store results in <generate>
# assumes <transfer>/<m> exists with mrs parse results
logon_generate () {
	transfer=$1
	generate=$2

	cat 2>&1 <<- GENERATE
		(lkb::read-script-file-aux "$grammarscript")
		(lkb::index-for-generator)
	GENERATE
	
	if [ -n "$limit" ]; then
		i=0
		while [ $i -lt $limit ]; do
			logon_setup_profile $transfer/$i
			# need to make a separate limit for generation results
			j=0
			while [ $j -lt $limit ];
			do
				logon_setup_profile $generate/$i/$m
				cat 2>&1 <<- GENERATE
					(tsdb::tsdb-do-process "$generate/$i/$j"
					  :condition "result-id=$j"
	                  :type :generate :overwrite t
	                  :gold "$transfer/$i")
				GENERATE
				j=`expr $j + 1`
			done
			i=`expr $i + 1`
		done
	fi
}

logon_generate $*
